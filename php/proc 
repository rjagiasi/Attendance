CREATE FUNCTION `GetAttReport`(`subject` INT, `student` INT) RETURNS INT NOT DETERMINISTIC NO SQL SQL SECURITY DEFINER BEGIN DECLARE nooflect int; DECLARE lectattended int; DECLARE percent float; SELECT COUNT(DISTINCT Date) INTO nooflect FROM Record WHERE Record.SubjectId = subject; SELECT COUNT(*) INTO lectattended FROM Record WHERE Record.SubjectId = subject AND Record.StudentId = student AND Record.PA = b'1'; SET percent = lectattended/nooflect; RETURN percent; END

SELECT Student.ClassId, Student.RollNo, Record.SubjectId, COUNT(Record.PA)
FROM Record JOIN Student
ON Student.StudentId = Record.StudentId AND Record.PA = b'1'
GROUP BY Record.SubjectId, Record.StudentId

--new

select 
s.RollNo, sub.SubjectId,
COUNT(CASE WHEN r.PA = 0x01 then 1 ELSE NULL END) as "Pres",
COUNT(CASE WHEN r.PA = 0x00 then 1 ELSE NULL END) as "Abs"
from `Attendance`.`Student` as s
right join Subjects as sub 
on sub.ClassId  = 1
join `Attendance`.`Record` as r
on s.StudentId = r.StudentId AND  r.SubjectId = sub.SubjectId and s.ClassId = 1 AND r.Date BETWEEN '2016-05-02' AND '2016-09-05'
group by r.SubjectId,r.StudentId
ORDER BY RollNo, SubjectId ASC

--
Select temp.* from (select 
s.RollNo, r.SubjectId,

COUNT(CASE WHEN r.PA = 0x01 then 1 ELSE NULL END) as "Pres",
COUNT(CASE WHEN r.PA = 0x00 then 1 ELSE NULL END) as "Abs"

from `Attendance`.`Student` as s
join `Attendance`.`Record` as r
on s.StudentId = r.StudentId AND s.ClassId = 1 AND r.Date BETWEEN '2016-05-30' AND '2016-09-04'
group by r.SubjectId,r.StudentId) as temp
RIGHT JOIN Subjects as sub
ON sub.SubjectId = temp.SubjectId and sub.ClassId = 1
ORDER BY temp.RollNo, temp.SubjectId ASC


--original

(select 
 `Attendance`.`Student`.`RollNo` AS `RollNo`,
 `Attendance`.`Record`.`SubjectId` AS `SubjectId`,
 
COUNT(CASE WHEN Record.PA = 0x01 then 1 ELSE NULL END) as "Pres",
COUNT(CASE WHEN Record.PA = 0x00 then 1 ELSE NULL END) as "Abs"
 
 from (`Attendance`.`Student` 
       join `Attendance`.`Record` 
       on(((
           `Attendance`.`Student`.`StudentId` = `Attendance`.`Record`.`StudentId`
       ) 
           AND Student.ClassId = classId 
           AND Record.Date BETWEEN startDate AND endDate))) 
 group by `Attendance`.`Record`.`SubjectId`,`Attendance`.`Record`.`StudentId`)
 ORDER BY RollNo, SubjectId ASC


--cursor demo
DELIMITER $$
CREATE PROCEDURE curdemo()
BEGIN
  DECLARE done INT DEFAULT FALSE;
  DECLARE a CHAR(16);
  DECLARE b, c INT;
  DECLARE cur1 CURSOR FOR SELECT Subjectid,Name FROM Subjects;
  DECLARE cur2 CURSOR FOR SELECT StaffId FROM Staff;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

  OPEN cur1;
  OPEN cur2;

  read_loop: LOOP
    FETCH cur1 INTO a, b;
    FETCH cur2 INTO c;
    IF done THEN
      LEAVE read_loop;
    END IF;
    IF b < c THEN
      INSERT INTO test.t3 VALUES (a,b);
    ELSE
      INSERT INTO test.t3 VALUES (a,c);
    END IF;
  END LOOP;

  CLOSE cur1;
  CLOSE cur2;
END$$
DELIMITER